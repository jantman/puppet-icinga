<%= scope.lookupvar('icinga::gui::apache_allow_stanza') %>
    AuthName "Icinga Access"
    AuthType Basic
<% if scope.lookupvar('icinga::params::web_auth_type') == 'ldap' -%>
    AuthBasicProvider ldap
<% if @ldap_binddn -%>
    AuthLDAPBindDN "<%= @ldap_binddn %>"
<% end -%>
<% if @ldap_bindpw -%>
    AuthLDAPBindPassword "<%= @ldap_bindpw %>"
<% end -%>
<% if @ldap_userattr -%>
    AuthLDAPRemoteUserAttribute <%= @ldap_userattr %>
<% end -%>
##    AuthLDAPGroupAttribute <%= scope.lookupvar('icinga::params::ldap_groupattr') %>
    AuthLDAPURL "ldap<% if scope.lookupvar('icinga::params::ldap_security') == 'ssl' %>s<% end %>://<%= scope.lookupvar('icinga::params::ldap_server') %>/<%= scope.lookupvar('icinga::params::ldap_groupdn') %>?<%= scope.lookupvar('icinga::params::ldap_userattr') %>"
<% if ! @ldap_authoritative -%>
    AuthzLDAPAuthoritative off
<% end -%>
<% if scope.lookupvar('icinga::params::ldap_auth_group') -%>
    require ldap-group "<%= scope.lookupvar('icinga::params::ldap_auth_group') %>"
<% end -%>
<% if @ldap_auth_groups -%>
<% @ldap_auth_groups.each do |group| -%>
    require ldap-group "<%= group %>"
<% end -%>
<% end -%>
<% if @ldap_auth_users -%>
<% @ldap_auth_users.each do |user| -%>
    require ldap-user "<%= user %>"
<% end -%>
<% end -%>
<% if @ldap_auth_dns -%>
<% @ldap_auth_dns.each do |dn| -%>
    require ldap-dn "<%= dn %>"
<% end -%>
<% end -%>
<% if scope.lookupvar('icinga::params::ldap_filter_extra') != 'undef' -%>
<% else -%>
    require ldap-filter "<%= scope.lookupvar('icinga::params::ldap_filter_extra') %>"
<% end -%>
<% else -%>
    AuthType Basic
    AuthUserFile /etc/auth/htpasswd.users
    AuthGroupFile /etc/auth/htpasswd.groups
<% end -%>
    Require valid-user
